{"version":3,"file":"app-core-eWg5aoaj.js","sources":["../../src/core/EventBus.js","../../src/core/PerformanceMonitor.js","../../src/core/SceneManager.js"],"sourcesContent":["/**\n * EventBus - Decoupled event communication system\n * Implements Observer/PubSub pattern for module communication\n *\n * @enterprise-pattern Observer/PubSub\n * @responsibility Event handling, module communication\n */\n\nexport class EventBus {\n    static instance = null;\n\n    /**\n     * Singleton accessor\n     * @returns {EventBus}\n     */\n    static getInstance() {\n        if (!EventBus.instance) {\n            EventBus.instance = new EventBus();\n        }\n        return EventBus.instance;\n    }\n\n    constructor() {\n        if (EventBus.instance) {\n            throw new Error('EventBus is a singleton. Use getInstance()');\n        }\n\n        this.listeners = new Map();\n        this.onceListeners = new Map();\n    }\n\n    /**\n     * Subscribe to an event\n     * @param {string} event - Event name\n     * @param {Function} callback - Event handler\n     * @returns {Function} Unsubscribe function\n     */\n    on(event, callback) {\n        if (!this.listeners.has(event)) {\n            this.listeners.set(event, new Set());\n        }\n\n        this.listeners.get(event).add(callback);\n\n        // Return unsubscribe function\n        return () => this.off(event, callback);\n    }\n\n    /**\n     * Subscribe to event (fires once then unsubscribes)\n     * @param {string} event - Event name\n     * @param {Function} callback - Event handler\n     */\n    once(event, callback) {\n        if (!this.onceListeners.has(event)) {\n            this.onceListeners.set(event, new Set());\n        }\n\n        this.onceListeners.get(event).add(callback);\n    }\n\n    /**\n     * Unsubscribe from an event\n     * @param {string} event - Event name\n     * @param {Function} callback - Event handler to remove\n     */\n    off(event, callback) {\n        if (this.listeners.has(event)) {\n            this.listeners.get(event).delete(callback);\n        }\n\n        if (this.onceListeners.has(event)) {\n            this.onceListeners.get(event).delete(callback);\n        }\n    }\n\n    /**\n     * Emit an event\n     * @param {string} event - Event name\n     * @param {*} data - Event data\n     */\n    emit(event, data) {\n        // Fire regular listeners\n        if (this.listeners.has(event)) {\n            this.listeners.get(event).forEach((callback) => {\n                try {\n                    callback(data);\n                } catch (error) {\n                    console.error(`Error in event listener for \"${event}\":`, error);\n                }\n            });\n        }\n\n        // Fire and remove once listeners\n        if (this.onceListeners.has(event)) {\n            this.onceListeners.get(event).forEach((callback) => {\n                try {\n                    callback(data);\n                } catch (error) {\n                    console.error(`Error in once listener for \"${event}\":`, error);\n                }\n            });\n            this.onceListeners.delete(event);\n        }\n    }\n\n    /**\n     * Remove all listeners for an event\n     * @param {string} event - Event name\n     */\n    clear(event) {\n        this.listeners.delete(event);\n        this.onceListeners.delete(event);\n    }\n\n    /**\n     * Remove all listeners\n     */\n    clearAll() {\n        this.listeners.clear();\n        this.onceListeners.clear();\n    }\n\n    /**\n     * Get listener count for an event\n     * @param {string} event - Event name\n     * @returns {number}\n     */\n    listenerCount(event) {\n        const regularCount = this.listeners.has(event) ? this.listeners.get(event).size : 0;\n        const onceCount = this.onceListeners.has(event) ? this.onceListeners.get(event).size : 0;\n        return regularCount + onceCount;\n    }\n}\n","/**\n * PerformanceMonitor - Performance tracking and quality scaling\n * Monitors FPS, frame time, and automatically adjusts quality settings\n *\n * @enterprise-pattern Singleton\n * @responsibility Performance monitoring, quality management\n */\n\nimport { EventBus } from './EventBus.js';\n\nexport class PerformanceMonitor {\n    static instance = null;\n\n    /**\n     * Singleton accessor\n     * @returns {PerformanceMonitor}\n     */\n    static getInstance() {\n        if (!PerformanceMonitor.instance) {\n            PerformanceMonitor.instance = new PerformanceMonitor();\n        }\n        return PerformanceMonitor.instance;\n    }\n\n    constructor() {\n        if (PerformanceMonitor.instance) {\n            throw new Error('PerformanceMonitor is a singleton. Use getInstance()');\n        }\n\n        this.eventBus = EventBus.getInstance();\n\n        // Performance metrics\n        this.fps = 60;\n        this.frameTime = 0;\n        this.lastTime = performance.now();\n        this.frames = 0;\n        this.fpsUpdateInterval = 1000; // Update FPS every second\n        this.lastFpsUpdate = performance.now();\n\n        // Quality levels\n        this.qualityLevels = {\n            HIGH: { pixelRatio: 2, shadows: true, particles: 1000, antialiasing: true },\n            MEDIUM: { pixelRatio: 1.5, shadows: true, particles: 500, antialiasing: true },\n            LOW: { pixelRatio: 1, shadows: false, particles: 200, antialiasing: false }\n        };\n\n        this.currentQuality = 'HIGH';\n\n        // Performance thresholds\n        this.targetFPS = 60;\n        this.minAcceptableFPS = 30;\n        this.autoQualityAdjust = true;\n\n        // Frame time tracking for averaging\n        this.frameTimes = [];\n        this.maxFrameTimeSamples = 60;\n\n        // Memory tracking\n        this.memoryWarningThreshold = 0.8; // 80% of available memory\n    }\n\n    /**\n     * Begin frame timing\n     */\n    begin() {\n        this.beginTime = performance.now();\n    }\n\n    /**\n     * End frame timing and update metrics\n     */\n    end() {\n        const currentTime = performance.now();\n        this.frameTime = currentTime - this.beginTime;\n        this.frames++;\n\n        // Track frame times\n        this.frameTimes.push(this.frameTime);\n        if (this.frameTimes.length > this.maxFrameTimeSamples) {\n            this.frameTimes.shift();\n        }\n\n        // Update FPS\n        if (currentTime - this.lastFpsUpdate >= this.fpsUpdateInterval) {\n            this.fps = Math.round((this.frames * 1000) / (currentTime - this.lastFpsUpdate));\n            this.frames = 0;\n            this.lastFpsUpdate = currentTime;\n\n            // Auto quality adjustment\n            if (this.autoQualityAdjust) {\n                this.adjustQuality();\n            }\n\n            // Emit FPS update\n            this.eventBus.emit('performance:fps', { fps: this.fps });\n        }\n\n        this.lastTime = currentTime;\n    }\n\n    /**\n     * Get current FPS\n     * @returns {number}\n     */\n    getFPS() {\n        return this.fps;\n    }\n\n    /**\n     * Get average frame time\n     * @returns {number} Average frame time in ms\n     */\n    getAverageFrameTime() {\n        if (this.frameTimes.length === 0) return 0;\n        const sum = this.frameTimes.reduce((a, b) => a + b, 0);\n        return sum / this.frameTimes.length;\n    }\n\n    /**\n     * Get current quality level\n     * @returns {string}\n     */\n    getQuality() {\n        return this.currentQuality;\n    }\n\n    /**\n     * Set quality level\n     * @param {string} quality - 'HIGH', 'MEDIUM', or 'LOW'\n     */\n    setQuality(quality) {\n        if (!this.qualityLevels[quality]) {\n            console.warn(`Invalid quality level: ${quality}`);\n            return;\n        }\n\n        this.currentQuality = quality;\n        this.eventBus.emit('performance:quality-changed', {\n            quality,\n            settings: this.qualityLevels[quality]\n        });\n    }\n\n    /**\n     * Get quality settings\n     * @returns {Object}\n     */\n    getQualitySettings() {\n        return this.qualityLevels[this.currentQuality];\n    }\n\n    /**\n     * Automatically adjust quality based on performance\n     */\n    adjustQuality() {\n        const avgFrameTime = this.getAverageFrameTime();\n        const currentFPS = this.fps;\n\n        // Downgrade quality if performance is poor\n        if (currentFPS < this.minAcceptableFPS && avgFrameTime > 33) { // 33ms = ~30fps\n            if (this.currentQuality === 'HIGH') {\n                this.setQuality('MEDIUM');\n                console.log('⚠️ Quality downgraded to MEDIUM (FPS:', currentFPS, ')');\n            } else if (this.currentQuality === 'MEDIUM') {\n                this.setQuality('LOW');\n                console.log('⚠️ Quality downgraded to LOW (FPS:', currentFPS, ')');\n            }\n        }\n\n        // Upgrade quality if performance is good\n        if (currentFPS >= this.targetFPS && avgFrameTime < 16) { // 16ms = 60fps\n            if (this.currentQuality === 'LOW') {\n                this.setQuality('MEDIUM');\n                console.log('✅ Quality upgraded to MEDIUM (FPS:', currentFPS, ')');\n            } else if (this.currentQuality === 'MEDIUM') {\n                this.setQuality('HIGH');\n                console.log('✅ Quality upgraded to HIGH (FPS:', currentFPS, ')');\n            }\n        }\n    }\n\n    /**\n     * Enable/disable automatic quality adjustment\n     * @param {boolean} enabled\n     */\n    setAutoQualityAdjust(enabled) {\n        this.autoQualityAdjust = enabled;\n    }\n\n    /**\n     * Check memory usage (if available)\n     * @returns {Object|null}\n     */\n    getMemoryInfo() {\n        if (!performance.memory) {\n            return null;\n        }\n\n        const memory = performance.memory;\n        const usedMemoryMB = memory.usedJSHeapSize / 1048576;\n        const totalMemoryMB = memory.totalJSHeapSize / 1048576;\n        const limitMemoryMB = memory.jsHeapSizeLimit / 1048576;\n\n        const usagePercentage = usedMemoryMB / limitMemoryMB;\n\n        // Emit warning if memory usage is high\n        if (usagePercentage > this.memoryWarningThreshold) {\n            this.eventBus.emit('performance:memory-warning', {\n                usedMemoryMB,\n                totalMemoryMB,\n                limitMemoryMB,\n                usagePercentage\n            });\n        }\n\n        return {\n            used: usedMemoryMB.toFixed(2),\n            total: totalMemoryMB.toFixed(2),\n            limit: limitMemoryMB.toFixed(2),\n            usagePercentage: (usagePercentage * 100).toFixed(2)\n        };\n    }\n\n    /**\n     * Get performance report\n     * @returns {Object}\n     */\n    getReport() {\n        return {\n            fps: this.fps,\n            avgFrameTime: this.getAverageFrameTime().toFixed(2),\n            quality: this.currentQuality,\n            qualitySettings: this.getQualitySettings(),\n            memory: this.getMemoryInfo()\n        };\n    }\n\n    /**\n     * Reset performance metrics\n     */\n    reset() {\n        this.fps = 60;\n        this.frameTime = 0;\n        this.frames = 0;\n        this.frameTimes = [];\n        this.lastFpsUpdate = performance.now();\n        this.lastTime = performance.now();\n    }\n}\n","/**\n * SceneManager - Centralized Three.js scene orchestration\n * Implements Singleton pattern for global scene management\n * Handles WebGL/WebGPU detection, renderer setup, and scene lifecycle\n *\n * @enterprise-pattern Singleton\n * @responsibility Scene lifecycle, renderer management, render loop\n */\n\nimport * as THREE from 'three';\nimport { PerformanceMonitor } from './PerformanceMonitor.js';\nimport { EventBus } from './EventBus.js';\n\nexport class SceneManager {\n    static instance = null;\n\n    /**\n     * Singleton accessor\n     * @returns {SceneManager}\n     */\n    static getInstance() {\n        if (!SceneManager.instance) {\n            SceneManager.instance = new SceneManager();\n        }\n        return SceneManager.instance;\n    }\n\n    constructor() {\n        if (SceneManager.instance) {\n            throw new Error('SceneManager is a singleton. Use getInstance()');\n        }\n\n        this.scene = null;\n        this.renderer = null;\n        this.activeCamera = null;\n        this.renderTargets = new Map();\n        this.activeScenes = new Map();\n        this.animationFrameId = null;\n        this.isInitialized = false;\n\n        // Performance monitoring\n        this.performanceMonitor = PerformanceMonitor.getInstance();\n        this.eventBus = EventBus.getInstance();\n\n        // Render callbacks\n        this.beforeRenderCallbacks = [];\n        this.afterRenderCallbacks = [];\n    }\n\n    /**\n     * Initialize Three.js renderer with WebGPU/WebGL detection\n     * @param {HTMLElement} container - DOM container for renderer\n     * @param {Object} options - Renderer configuration\n     * @returns {Promise<boolean>} Success status\n     */\n    async initialize(container, options = {}) {\n        if (this.isInitialized) {\n            console.warn('SceneManager already initialized');\n            return true;\n        }\n\n        try {\n            // Detect WebGPU support\n            const hasWebGPU = 'gpu' in navigator;\n\n            // Configure renderer with fallback\n            const rendererConfig = {\n                antialias: options.antialias ?? true,\n                alpha: options.alpha ?? true,\n                powerPreference: options.powerPreference ?? 'high-performance',\n                stencil: options.stencil ?? false,\n                preserveDrawingBuffer: options.preserveDrawingBuffer ?? false,\n                ...options\n            };\n\n            // Create renderer\n            this.renderer = new THREE.WebGLRenderer(rendererConfig);\n            this.renderer.setSize(container.clientWidth, container.clientHeight);\n            this.renderer.setPixelRatio(this.getOptimalPixelRatio());\n            this.renderer.shadowMap.enabled = true;\n            this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n            this.renderer.toneMapping = THREE.ACESFilmicToneMapping;\n            this.renderer.toneMappingExposure = 1.0;\n            this.renderer.outputEncoding = THREE.sRGBEncoding;\n\n            // Append to container\n            container.appendChild(this.renderer.domElement);\n            this.renderer.domElement.style.position = 'fixed';\n            this.renderer.domElement.style.top = '0';\n            this.renderer.domElement.style.left = '0';\n            this.renderer.domElement.style.zIndex = '-1';\n            this.renderer.domElement.style.pointerEvents = 'none';\n\n            // Create main scene\n            this.scene = new THREE.Scene();\n            this.scene.background = null; // Transparent for layering\n\n            // Setup resize observer\n            this.setupResizeObserver(container);\n\n            // Setup render loop\n            this.startRenderLoop();\n\n            this.isInitialized = true;\n            this.eventBus.emit('scene:initialized', { hasWebGPU });\n\n            console.log(`✅ SceneManager initialized (WebGPU: ${hasWebGPU})`);\n            return true;\n\n        } catch (error) {\n            console.error('Failed to initialize SceneManager:', error);\n            this.eventBus.emit('scene:error', { error });\n            return false;\n        }\n    }\n\n    /**\n     * Calculate optimal pixel ratio based on device and performance\n     * @returns {number} Pixel ratio\n     */\n    getOptimalPixelRatio() {\n        const devicePixelRatio = window.devicePixelRatio || 1;\n\n        // Cap pixel ratio for performance\n        // Mobile devices: max 2, Desktop: max 2.5\n        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n        const maxRatio = isMobile ? 2 : 2.5;\n\n        return Math.min(devicePixelRatio, maxRatio);\n    }\n\n    /**\n     * Setup responsive resize handling\n     * @param {HTMLElement} container\n     */\n    setupResizeObserver(container) {\n        const resizeObserver = new ResizeObserver((entries) => {\n            for (const entry of entries) {\n                const { width, height } = entry.contentRect;\n                this.handleResize(width, height);\n            }\n        });\n\n        resizeObserver.observe(container);\n        this.resizeObserver = resizeObserver;\n    }\n\n    /**\n     * Handle window/container resize\n     * @param {number} width\n     * @param {number} height\n     */\n    handleResize(width, height) {\n        if (!this.renderer) return;\n\n        this.renderer.setSize(width, height);\n\n        // Update all active cameras\n        this.activeScenes.forEach((sceneData) => {\n            if (sceneData.camera && sceneData.camera.isPerspectiveCamera) {\n                sceneData.camera.aspect = width / height;\n                sceneData.camera.updateProjectionMatrix();\n            }\n        });\n\n        this.eventBus.emit('scene:resize', { width, height });\n    }\n\n    /**\n     * Register a named scene with its camera\n     * @param {string} name - Scene identifier\n     * @param {THREE.Scene} scene\n     * @param {THREE.Camera} camera\n     */\n    registerScene(name, scene, camera) {\n        this.activeScenes.set(name, { scene, camera, enabled: true });\n        this.eventBus.emit('scene:registered', { name });\n    }\n\n    /**\n     * Set active camera for rendering\n     * @param {THREE.Camera} camera\n     */\n    setActiveCamera(camera) {\n        this.activeCamera = camera;\n        this.eventBus.emit('camera:changed', { camera });\n    }\n\n    /**\n     * Add callback to execute before each render\n     * @param {Function} callback\n     */\n    onBeforeRender(callback) {\n        this.beforeRenderCallbacks.push(callback);\n    }\n\n    /**\n     * Add callback to execute after each render\n     * @param {Function} callback\n     */\n    onAfterRender(callback) {\n        this.afterRenderCallbacks.push(callback);\n    }\n\n    /**\n     * Main render loop\n     */\n    startRenderLoop() {\n        const render = (time) => {\n            this.animationFrameId = requestAnimationFrame(render);\n\n            // Performance monitoring\n            this.performanceMonitor.begin();\n\n            // Execute before render callbacks\n            this.beforeRenderCallbacks.forEach(cb => cb(time));\n\n            // Render all active scenes\n            if (this.scene && this.activeCamera) {\n                this.renderer.render(this.scene, this.activeCamera);\n            }\n\n            // Execute after render callbacks\n            this.afterRenderCallbacks.forEach(cb => cb(time));\n\n            // End performance monitoring\n            this.performanceMonitor.end();\n\n            // Emit render event\n            this.eventBus.emit('scene:render', { time });\n        };\n\n        this.animationFrameId = requestAnimationFrame(render);\n    }\n\n    /**\n     * Pause render loop\n     */\n    pause() {\n        if (this.animationFrameId) {\n            cancelAnimationFrame(this.animationFrameId);\n            this.animationFrameId = null;\n            this.eventBus.emit('scene:paused');\n        }\n    }\n\n    /**\n     * Resume render loop\n     */\n    resume() {\n        if (!this.animationFrameId) {\n            this.startRenderLoop();\n            this.eventBus.emit('scene:resumed');\n        }\n    }\n\n    /**\n     * Clean up resources and destroy scene\n     */\n    dispose() {\n        // Cancel animation frame\n        this.pause();\n\n        // Dispose renderer\n        if (this.renderer) {\n            this.renderer.dispose();\n            this.renderer.domElement.remove();\n            this.renderer = null;\n        }\n\n        // Dispose scenes\n        this.activeScenes.forEach(({ scene }) => {\n            this.disposeScene(scene);\n        });\n        this.activeScenes.clear();\n\n        // Clear callbacks\n        this.beforeRenderCallbacks = [];\n        this.afterRenderCallbacks = [];\n\n        // Dispose resize observer\n        if (this.resizeObserver) {\n            this.resizeObserver.disconnect();\n            this.resizeObserver = null;\n        }\n\n        this.isInitialized = false;\n        this.eventBus.emit('scene:disposed');\n    }\n\n    /**\n     * Recursively dispose Three.js scene objects\n     * @param {THREE.Scene|THREE.Object3D} object\n     */\n    disposeScene(object) {\n        if (!object) return;\n\n        // Traverse and dispose\n        object.traverse((child) => {\n            if (child.geometry) {\n                child.geometry.dispose();\n            }\n\n            if (child.material) {\n                if (Array.isArray(child.material)) {\n                    child.material.forEach(material => this.disposeMaterial(material));\n                } else {\n                    this.disposeMaterial(child.material);\n                }\n            }\n\n            if (child.dispose) {\n                child.dispose();\n            }\n        });\n    }\n\n    /**\n     * Dispose material and its textures\n     * @param {THREE.Material} material\n     */\n    disposeMaterial(material) {\n        if (!material) return;\n\n        // Dispose textures\n        Object.keys(material).forEach((key) => {\n            const value = material[key];\n            if (value && value.isTexture) {\n                value.dispose();\n            }\n        });\n\n        material.dispose();\n    }\n\n    /**\n     * Get renderer stats for debugging\n     * @returns {Object}\n     */\n    getStats() {\n        if (!this.renderer) return null;\n\n        return {\n            triangles: this.renderer.info.render.triangles,\n            calls: this.renderer.info.render.calls,\n            geometries: this.renderer.info.memory.geometries,\n            textures: this.renderer.info.memory.textures,\n            fps: this.performanceMonitor.getFPS()\n        };\n    }\n}\n"],"names":["_EventBus","getInstance","instance","constructor","Error","this","listeners","Map","onceListeners","on","event","callback","has","set","Set","get","add","off","once","delete","emit","data","forEach","error","clear","clearAll","listenerCount","size","__publicField","EventBus","_PerformanceMonitor","eventBus","fps","frameTime","lastTime","performance","now","frames","fpsUpdateInterval","lastFpsUpdate","qualityLevels","HIGH","pixelRatio","shadows","particles","antialiasing","MEDIUM","LOW","currentQuality","targetFPS","minAcceptableFPS","autoQualityAdjust","frameTimes","maxFrameTimeSamples","memoryWarningThreshold","begin","beginTime","end","currentTime","push","length","shift","Math","round","adjustQuality","getFPS","getAverageFrameTime","reduce","a","b","getQuality","setQuality","quality","settings","getQualitySettings","avgFrameTime","currentFPS","setAutoQualityAdjust","enabled","getMemoryInfo","memory","usedMemoryMB","usedJSHeapSize","totalMemoryMB","totalJSHeapSize","limitMemoryMB","jsHeapSizeLimit","usagePercentage","used","toFixed","total","limit","getReport","qualitySettings","reset","PerformanceMonitor","_SceneManager","scene","renderer","activeCamera","renderTargets","activeScenes","animationFrameId","isInitialized","performanceMonitor","beforeRenderCallbacks","afterRenderCallbacks","initialize","container","options","hasWebGPU","navigator","rendererConfig","antialias","alpha","powerPreference","stencil","preserveDrawingBuffer","THREE.WebGLRenderer","setSize","clientWidth","clientHeight","setPixelRatio","getOptimalPixelRatio","shadowMap","type","THREE.PCFSoftShadowMap","toneMapping","THREE.ACESFilmicToneMapping","toneMappingExposure","outputEncoding","THREE.sRGBEncoding","appendChild","domElement","style","position","top","left","zIndex","pointerEvents","THREE.Scene","background","setupResizeObserver","startRenderLoop","devicePixelRatio","window","maxRatio","test","userAgent","min","resizeObserver","ResizeObserver","entries","entry","width","height","contentRect","handleResize","observe","sceneData","camera","isPerspectiveCamera","aspect","updateProjectionMatrix","registerScene","name","setActiveCamera","onBeforeRender","onAfterRender","render","time","requestAnimationFrame","cb","pause","cancelAnimationFrame","resume","dispose","remove","disposeScene","disconnect","object","traverse","child","geometry","material","Array","isArray","disposeMaterial","Object","keys","key","value","isTexture","getStats","triangles","info","calls","geometries","textures","SceneManager"],"mappings":"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"}